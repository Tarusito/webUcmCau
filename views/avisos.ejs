<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="img/favicon.ico">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
  integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"
  integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="scripts/modalShowHide.js"></script>
  <link rel="stylesheet" href="css/avisos.css">
  <title>Avisos</title>
</head>

<body>
  <%- include("header") %>

  <div class="container">
    <div class="row mt-4 row-cols-auto">
      <div class="col">
        <a href="">Mis avisos</a>
      </div>
      <div class="col">
        |
      </div>
      <div class="col">
        <a href="/avisosHistorico">Histórico de Avisos</a>
      </div>
    </div>
  </div>
  <div class="container-sm mt-3">
  <table class="table table-dark table-striped me-5">
    <thead>
      <tr>
        <th scope="col">Fecha</th>
        <th scope="col">Texto</th>
        <th scope="col">Tipo</th>
        <th scope="col">Técnico</th>
      </tr>
    </thead>
    <tbody>
    <% avisos.forEach(function(aviso){ %>
      <tr class="getText" data-bs-toggle="modal" data-bs-target="#plantillaModal" style="cursor: pointer;"
      id="<%= aviso.id %>-<%= aviso.tipo %>-<%= aviso.fecha %>-<%= aviso.texto %>-<%= aviso.textoTecnico %>-<%= aviso.categoriaFuncion %>-<%= aviso.funcion %>">
        <td scope="row"><%= aviso.fecha %></td>
        <% if (aviso.texto.length < 200){ %>
          <td><%= aviso.texto%></td>
          <% } else { %>
          <td><%= aviso.texto.substr(0,200)%>...</td>
          <% } %>
        <% if(aviso.tipo == "Sugerencia"){ %>
        <td><img src="img/sugerencia.png" alt="sugerencia"></td>
        <% } else if (aviso.tipo == "Incidencia"){%>
          <td><img src="img/incidencia.png" alt="incidencia"></td>
        <% } else { %>
          <td><img src="img/felicitacion.png" alt="felicitacion"></td>
          <% } %>
        <td><%= aviso.nombre %></td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>
  <!--
  <div class="container-sm mt-3">
    <div class="row border border-dark">
      <div class="col-2 border border-dark">Fecha</div>
      <div class="col-6 border border-dark">Texto</div>
      <div class="col-2 border border-dark">Tipo</div>
      <div class="col-2 border border-dark">Técnico</div>
    </div>
    <% avisos.forEach(function(aviso){ %>
    <div class="row border getText" data-bs-toggle="modal" data-bs-target="#plantillaModal"
      id="<%= aviso.id %>-<%= aviso.tipo %>-<%= aviso.fecha %>-<%= aviso.texto %>-<%= aviso.textoTecnico %>-<%= aviso.categoriaFuncion %>-<%= aviso.funcion %>">
      <div class="col-2 border border-dark"><%= aviso.fecha %></div>
      <div class="col-6 border border-dark">
        <% if (aviso.texto.length < 200){ %>
        <p id="textoBuscar"><%= aviso.texto%></p>
        <% } else { %>
        <p id="textoBuscar"><%= aviso.texto.substr(0,200)%>...</p>
        <% } %>
      </div>
      <div class="col-2 border border-dark"><%= aviso.tipo %></div>
      <% if (aviso.nombre != null){ %>
      <div class="col-2 border border-dark"><%= aviso.nombre %></div>
      <% } else { %>
      <div class="col-2 border border-dark"></div>
      <% } %>
    </div>
    <% }); %>
  </div>
-->
  <div class="container">
    <div class="row mt-4 justify-content-between row-cols-auto">
      <div class="col p-0">

      </div>
      <div class="col p-0">
        <a href="" class="m-0 btn btn-dark" data-bs-toggle="modal" data-bs-target="#nuevoAviso">
          <h4 class="m-0">Nuevo aviso</h4>
        </a>
      </div>
    </div>
  </div>
  </div>

  <!-- Modal Nuevo Aviso -->
  <div class="modal fade" id="nuevoAviso" tabindex="-1" aria-labelledby="nuevoAvisoLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="nuevoAvisoLabel">Selecciona el tipo de aviso</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <div class="row row-cols-auto justify-content-center">
            <div class="col">
              <div class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#sugerencia">Sugerencia</div>
            </div>
            <div class="col">
              <div class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#incidencia">Incidencia</div>
            </div>
            <div class="col">
              <div class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#felicitacion">Felicitacion</div>
            </div>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Sugerencia -->
  <div class="modal fade" id="sugerencia" tabindex="-1" aria-labelledby="sugerenciaLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="sugerenciaLabel">Sugerencia</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="/crearAviso" id="formulario">
          <div class="modal-body">

            <select class="form-select miSelect" name="tipo" id="">
              <% let aux = tipos[0].categoria %>
              <option selected> </option>
              <optgroup label="<%=aux%>"></optgroup>
              <% tipos.forEach(function(tipo){ %>
                <% if(tipo.categoria != aux){%>
                  <% aux = tipo.categoria; %>
                  <optgroup label="<%=aux%>"></optgroup>
                  <% } %>                  
              <option value="<%=tipo.id%>-<%=tipo.nombre%>-<%=user.id%>-sugerencia" name="tipo"><%=tipo.nombre%>
              </option>
              <% }); %>
            </select>

            <textarea class="form-control mt-3 miTextArea" id="exampleFormControlTextarea1" rows="3" name="texto"></textarea>
          </div>
          <div class="modal-footer">
            <input type="submit" class="btn btn-dark miBoton" value="Crear" id="miBoton">
            <button type="button" class="btn btn-dark " data-bs-dismiss="modal">Close</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Incidencia -->
  <div class="modal fade" id="incidencia" tabindex="-1" aria-labelledby="incidenciaLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="incidenciaLabel">Incidencia</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="/crearAviso" id="formulario">
          <div class="modal-body">

            <select class="form-select miSelect2" name="tipo">
              <% let aux2 = tipos[0].categoria %>
              <option selected> </option>
              <optgroup label="<%=aux2%>"></optgroup>
              <% tipos.forEach(function(tipo){ %>
                <% if(tipo.categoria != aux2){%>
                  <% aux2 = tipo.categoria; %>
                  <optgroup label="<%=aux2%>"></optgroup>
                  <% } %>
              <option value="<%=tipo.id%>-<%=tipo.nombre%>-<%=user.id%>-incidencia" id="formSelected<%=tipo.nombre%>">
                <%=tipo.nombre%></option>
              <% }); %>
            </select>

            <textarea class="form-control mt-3 miTextArea2" id="exampleFormControlTextarea1" rows="3" name="texto"></textarea>
          </div>
          <div class="modal-footer">
            <input type="submit" class="btn btn-dark miBoton2" value="Crear">
            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Felicitación -->
  <div class="modal fade" id="felicitacion" tabindex="-1" aria-labelledby="felicitacionLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="felicitacionLabel">Felicitación</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="/crearFelicitacion" id="formulario">
          <div class="modal-body">
            <select class="form-select miSelect3" name="tipo">
              <option selected> </option>
              <% felicitaciones.forEach(function(feli){ %>
              <option value="<%=feli.nombre%>-<%=user.id%>-<%=feli.id%>" id="formSelected<%=feli.nombre%>">
                <%=feli.nombre%></option>
              <% }); %>
            </select>
            <textarea class="form-control mt-3 miTextArea3" id="exampleFormControlTextarea1" rows="3" name="texto"></textarea>
          </div>
          <div class="modal-footer">
            <input type="submit" class="btn btn-dark miBoton3" value="Crear">
            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Plantilla -->
  <div class="modal fade" id="plantillaModal" tabindex="-1" aria-labelledby="plantillaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="plantillaModalLabel">Aviso</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col">
              <h4><%= user.nombre %></h4>
            </div>
            <div class="col-6" id="avisoTipoModal">

            </div>
          </div>

          <div class="row mt-3" id="fechaModal">

          </div>
          <div class="row" id="comunicacionesModal">

          </div>
          <div class="row">
            <h6>Perfil: <%= user.perfilUniversitario %></h6>
          </div>
          <div class="row">
            <h6>Observaciones: </h6>
          </div>
          <div class="row border" id="textoModal">

          </div>
          
          <div class="row" id="tituloComentarioTecnico">
            
          </div>

          <div class="row border" id="textoTecnicoModal">

          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

</body>



</html>